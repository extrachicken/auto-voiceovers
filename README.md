# ElevenLabs Multi-Character Voice Synthesis Script

## Введение

Этот скрипт предназначен для автоматической озвучки диалогов из сценариев с несколькими персонажами с использованием API ElevenLabs. Он поддерживает файлы в форматах `.docx` и `.txt`, автоматически распознаёт формат, извлекает реплики персонажей, очищает их от лишних элементов (например, описаний в скобках) и генерирует аудиофайлы для каждой фразы. Аудиофайлы сохраняются в папках, названных по именам персонажей.

## Требования

- **Python 3.x**
- Необходимые библиотеки:
  - `argparse`
  - `python-docx` (для работы с `.docx`)
  - `re`
  - `requests`
  - `collections`
  - `os`
  - `json`
  - `sys`
- API-ключ от ElevenLabs (получите на [elevenlabs.io](https://elevenlabs.io)).

## Установка

1. Установите необходимые библиотеки с помощью `pip`:
   ```
   pip install python-docx requests
   ```

2. Получите API-ключ от ElevenLabs и замените значение переменной `API_KEY` в файле `script.py` на ваш ключ. По умолчанию используется placeholder:
   ```python
   API_KEY = ' '
   ```
   Замените его на ваш реальный ключ.

## Настройка

Настройки персонажей хранятся в файле `character_settings.json` в той же директории, что и скрипт. Пример структуры файла:

```json
{
    "Максим": {
        "voice_id": "3EuKHIEZbSzrHGNmdYsx",
        "speed": 1,
        "stability": 0.5,
        "similarity_boost": 0,
        "model_id": "eleven_turbo_v2_5"
    },
    "Директор": {
        "voice_id": "CwhRBWXzGAHq8TQ4Fs17",
        "speed": 1,
        "stability": 0.5,
        "similarity_boost": 0,
        "style": 0,
        "use_speaker_boost": false,
        "model_id": "eleven_multilingual_v2"
    }
}
```

Для каждого персонажа необходимо указать:
- `voice_id` — идентификатор голоса из ElevenLabs.
- `model_id` — модель синтеза речи (например, `eleven_turbo_v2_5` или `eleven_multilingual_v2`).
- Дополнительные параметры (`speed`, `stability`, `similarity_boost`, `style`, `use_speaker_boost`) — опциональны, зависят от модели.

Полный список параметров доступен в [документации ElevenLabs](https://elevenlabs.io/docs).

## Использование

Запустите скрипт из командной строки, указав путь к файлу сценария:
```
python script.py путь/к/сценарию.docx
```
или
```
python script.py путь/к/сценарию.txt
```

Скрипт:
1. Распознаёт формат файла (`.docx` или `.txt`).
2. Извлекает реплики персонажей в формате `Персонаж: фраза`.
3. Очищает фразы от лишних элементов (например, `(улыбается)`).
4. Выводит статистику по количеству фраз для каждого персонажа.
5. Генерирует аудиофайлы и сохраняет их в папки с именами персонажей.

Аудиофайлы называются в формате `Персонаж_Номер.mp3` (например, `Максим_1.mp3`).

## Пример

### Входной файл (`scenario.txt`):
```
Максим: Привет, как дела?
Директор: Всё отлично, спасибо!
Максим: Рад слышать (улыбается).
```

### Запуск:
```
python script.py scenario.txt
```

### Вывод:
```
=== Статистика по количеству фраз ===
Максим: 2 фраз(ы)
Директор: 1 фраз(ы)
====================================

Processing phrase 1 for Максим: 'Привет, как дела?'
Saved 'Максим/Максим_1.mp3'
Processing phrase 2 for Максим: 'Рад слышать'
Saved 'Максим/Максим_2.mp3'
Processing phrase 1 for Директор: 'Всё отлично, спасибо!'
Saved 'Директор/Директор_1.mp3'
```

### Результат:
- Папка `Максим`:
  - `Максим_1.mp3` — "Привет, как дела?"
  - `Максим_2.mp3` — "Рад слышать"
- Папка `Директор`:
  - `Директор_1.mp3` — "Всё отлично, спасибо!"

## Обработка ошибок

Скрипт обрабатывает следующие ошибки:
- Отсутствие файла `character_settings.json` — завершает работу с сообщением.
- Неверный формат JSON — завершает работу с сообщением.
- Неподдерживаемый формат файла — только `.docx` и `.txt` поддерживаются.
- Персонаж отсутствует в настройках — пропускает фразу с предупреждением.
- Ошибки API ElevenLabs — выводит код ошибки и описание.

## Расширенные возможности

- Поддержка различных моделей ElevenLabs (указываются в `model_id`).
- Индивидуальная настройка параметров голоса для каждого персонажа.


## Часто задаваемые вопросы (FAQ)

- **Как добавить нового персонажа?**  
  Добавьте блок с настройками персонажа в `character_settings.json`, указав `voice_id`, `model_id` и другие параметры.

- **Как изменить голос персонажа?**  
  Обновите `voice_id` в настройках персонажа в `character_settings.json`.

- **Что делать, если скрипт не находит файл настроек?**  
  Убедитесь, что `character_settings.json` находится в той же директории, что и `script.py`, и имеет корректный JSON-формат.

